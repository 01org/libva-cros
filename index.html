<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VA-API: Video Acceleration (VA) API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">VA-API
   &#160;<span id="projectnumber">2.11.0.pre1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Video Acceleration (VA) API </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="intro"></a>
Introduction</h1>
<p>The main motivation for VA-API (Video Acceleration API) is to enable hardware accelerated video decode and encode at various entry-points (VLD, IDCT, Motion Compensation etc.) for the prevailing coding standards today (MPEG-2, MPEG-4 ASP/H.263, MPEG-4 AVC/H.264, VC-1/VMW3, and JPEG, HEVC/H265, VP8, VP9) and video pre/post processing</p>
<p>VA-API is split into several modules:</p><ul>
<li><a class="el" href="group__api__core.html">Core API</a></li>
<li>Encoder (H264, HEVC, JPEG, MPEG2, VP8, VP9)<ul>
<li><a class="el" href="group__api__enc__h264.html">H.264 encoding API</a></li>
<li><a class="el" href="group__api__enc__hevc.html">HEVC encoding API</a></li>
<li><a class="el" href="group__api__enc__jpeg.html">JPEG encoding API</a></li>
<li><a class="el" href="group__api__enc__mpeg2.html">MPEG-2 encoding API</a></li>
<li><a class="el" href="group__api__enc__vp8.html">VP8 encoding API</a></li>
<li><a class="el" href="group__api__enc__vp9.html">VP9 encoding API</a></li>
</ul>
</li>
<li>Decoder (HEVC, JPEG, VP8, VP9, AV1)<ul>
<li><a class="el" href="group__api__dec__hevc.html">HEVC decoding API</a></li>
<li><a class="el" href="group__api__dec__jpeg.html">JPEG decoding API</a></li>
<li><a class="el" href="group__api__dec__vp8.html">VP8 decoding API</a></li>
<li><a class="el" href="group__api__dec__vp9.html">VP9 decoding API</a></li>
<li>api_dec_av1</li>
</ul>
</li>
<li><a class="el" href="group__api__vpp.html">Video processing API</a></li>
<li><a class="el" href="group__api__prot.html">Protected content API</a></li>
<li>FEI (H264, HEVC)<ul>
<li><a class="el" href="group__api__fei.html">FEI encoding common API</a></li>
<li><a class="el" href="group__api__fei__h264.html">H.264 FEI encoding API</a></li>
<li><a class="el" href="group__api__fei__hevc.html">HEVC FEI encoding API</a></li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="threading"></a>
Multithreading Guide</h1>
<p>All VAAPI functions implemented in libva are thread-safe. For any VAAPI function that requires the implementation of a backend (e.g. hardware driver), the backend must ensure that its implementation is also thread-safe. If the backend implementation of a VAAPI function is not thread-safe then this should be considered as a bug against the backend implementation.</p>
<p>It is assumed that none of the VAAPI functions will be called from signal handlers.</p>
<p>Thread-safety in this context means that when VAAPI is being called by multiple concurrent threads, it will not crash or hang the OS, and VAAPI internal data structures will not be corrupted. When multiple threads are operating on the same VAAPI objects, it is the application's responsibility to synchronize these operations in order to generate the expected results. For example, using a single VAContext from multiple threads may generate unexpected results.</p>
<p>Following pseudo code illustrates a multithreaded transcoding scenario, where one thread is handling the decoding operation and another thread is handling the encoding operation, while synchronizing the use of a common pool of surfaces.</p>
<p>// Initialization dpy = vaGetDisplayDRM(fd); vaInitialize(dpy, ...);</p>
<p>// Create surfaces required for decoding and subsequence encoding vaCreateSurfaces(dpy, VA_RT_FORMAT_YUV420, width, height, &amp;surfaces[0], ...);</p>
<p>// Set up a queue for the surfaces shared between decode and encode threads surface_queue = queue_create();</p>
<p>// Create decode_thread pthread_create(&amp;decode_thread, NULL, decode, ...);</p>
<p>// Create encode_thread pthread_create(&amp;encode_thread, NULL, encode, ...);</p>
<p>// Decode thread function decode() { // Find the decode entrypoint for H.264 vaQueryConfigEntrypoints(dpy, h264_profile, entrypoints, ...);</p>
<p>// Create a config for H.264 decode vaCreateConfig(dpy, h264_profile, VAEntrypointVLD, ...);</p>
<p>// Create a context for decode vaCreateContext(dpy, config, width, height, VA_PROGRESSIVE, surfaces, num_surfaces, &amp;decode_context);</p>
<p>// Decode frames in the bitstream for (;;) { // Parse one frame and decode vaBeginPicture(dpy, decode_context, surfaces[surface_index]); vaRenderPicture(dpy, decode_context, buf, ...); vaEndPicture(dpy, decode_context); // Poll the decoding status and enqueue the surface in display order after // decoding is complete <a class="el" href="group__api__core.html#ga59e5c937c8554f1bab043f80427c2fa8">vaQuerySurfaceStatus()</a>; enqueue(surface_queue, surface_index); } }</p>
<p>// Encode thread function encode() { // Find the encode entrypoint for HEVC vaQueryConfigEntrypoints(dpy, hevc_profile, entrypoints, ...);</p>
<p>// Create a config for HEVC encode vaCreateConfig(dpy, hevc_profile, VAEntrypointEncSlice, ...);</p>
<p>// Create a context for encode vaCreateContext(dpy, config, width, height, VA_PROGRESSIVE, surfaces, num_surfaces, &amp;encode_context);</p>
<p>// Encode frames produced by the decoder for (;;) { // Dequeue the surface enqueued by the decoder surface_index = dequeue(surface_queue); // Encode using this surface as the source vaBeginPicture(dpy, encode_context, surfaces[surface_index]); vaRenderPicture(dpy, encode_context, buf, ...); vaEndPicture(dpy, encode_context); } } </p>
</div></div><!-- contents -->
<hr class="footer"/><address class="footer"><small>
Generated for VA-API by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13</small></address>
</body>
</html>
